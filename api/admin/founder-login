// app/api/admin/founder-login/route.ts
import { NextResponse } from 'next/server';
import { createClient } from '@supabase/supabase-js';

export async function GET() {
  const SUPABASE_URL = process.env.SUPABASE_URL!;
  const SRK = process.env.SUPABASE_SERVICE_ROLE_KEY!;
  const FOUNDER_EMAIL = process.env.FOUNDER_EMAIL!;
  const REDIRECT = 'https://studio-founder.moralclarity.ai/auth?next=%2Fapp';

  if (!SUPABASE_URL || !SRK || !FOUNDER_EMAIL)
    return NextResponse.json({ error: 'Missing env vars' }, { status: 500 });

  const supabase = createClient(SUPABASE_URL, SRK, {
    auth: { autoRefreshToken: false, persistSession: false },
  });

  const { data, error } = await supabase.auth.admin.generateLink({
    type: 'magiclink',
    email: FOUNDER_EMAIL,
    options: { redirectTo: REDIRECT },
  });

  if (error) return NextResponse.json({ error: error.message }, { status: 500 });
  const link = data?.properties?.action_link;
  if (!link) return NextResponse.json({ error: 'No link returned' }, { status: 500 });

  return NextResponse.redirect(link, { status: 302 });
}
